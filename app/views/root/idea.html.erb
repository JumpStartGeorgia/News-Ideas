<%- model_class = Idea -%>
<% title t '.title', :default => model_class.model_name.human %>

<div id="idea_user_block" class="row" style="margin-bottom: 10px; border-bottom: solid 1px #ddd;">
	<div class="span4">
		<%= image_tag @idea.user.avatar, :style => 'float:left; padding-right: 5px;' if @idea.user.avatar %>
		<h2><%= link_to t('.idea_by', :name => @idea.user.nickname), user_path(@idea.user_id)%></h2>
		<% if !@idea.user.organization_users.empty? %>
			<% if @idea.user.organization_users.first.organization.logo_file_name %>
				<%= link_to(image_tag(@idea.user.organization_users.first.organization.logo.url),
						organization_path(@idea.user.organization_users.first.organization_id)) %>
			<% else %>
				<%= link_to @idea.user.organization_users.first.organization.name,
							organization_path(@idea.user.organization_users.first.organization_id) %>
			<% end %>
		<% end %>
	</div>
	<div class="span3">
		<%= l @idea.created_at, :format => :long %>
	</div>
	<div class="span1" style="text-align: right;">
		<%= "#{t('app.common.rate_it')}:" %>
    <%= votes_cont(@idea) %>
	</div>
</div>
<div id="idea_category_block" class="row" style="margin-bottom: 20px;">
	<div class="span5">
		<% @idea.idea_categories.each do |idea| %>
			<%= link_to idea.category.name, category_path(idea.category_id) %>
		<% end %>
	</div>
	<div class="span3" style="text-align: right;">
		(idea flags)
	</div>
</div>
<div id="idea_description_block" style="margin-bottom: 20px">
	<%= simple_format @idea.explaination %>
</div>

<div id="idea_social_block" class="row" style="margin-bottom: 10px;">
	<div class="span3">
		<%= link_to(image_tag("fb_share.jpg", :height => "20"),
					"http://www.facebook.com/share.php?u=#{current_url}",
					:title => "facebook",	:target => "_blank") %>
		<%= link_to(image_tag("twitter.jpg", :height => "20"),
					"https://twitter.com/share", :title => "twitter",
					:target => "_blank") %>
	</div>
	<div class="span3" style="text-align: right;">
		<% if current_user.organization_users && !current_user.organization_users.empty? &&
					!@idea.organization_claimed_idea?(current_user.organization_users.first.organization_id) %>

			<%= link_to t('.take_ownership', :org => current_user.organization_users.first.organization.name),
					claim_idea_path(:idea_id => @idea.id, :organization_id => current_user.organization_users.first.organization_id),
					:class => 'btn btn-mini btn-primary fancybox' %>
		<% else %>
			&nbsp;
		<% end %>
	</div>
	<div class="span2" style="text-align: right;">
		(report idea)
	</div>
</div>

<div id="idea_progress_block" style="margin-bottom: 10px;">
	<% if !@idea.idea_progresses.empty? %>
		<h3><%= t('.claimed_by') %></h3>
		<% @idea.claimed_by_organizations.each do |org| %>
			<div class="idea_progress_org" style="margin-left: 10px; margin-top: 10px; border: solid 1px #ddd; padding: 5px;">
				<% progresses = @idea.organization_progress(org.id) %>
				<div class="row" style="border-bottom: dashed 1px #ddd;">
					<div class="span3">
						<h4>
							<% if org.logo_file_name %>
								<%= link_to(image_tag(org.logo.url),
										organization_path(org.id)) %>
							<% else %>
								<%= link_to org.name,
											organization_path(org.id) %>
							<% end %>
						</h4>
					</div>
					<div class="span2">
						<% if current_user.organization_users && !current_user.organization_users.empty? &&
									org.id == current_user.organization_users.first.organization_id &&
									@idea.organization_claimed_idea?(current_user.organization_users.first.organization_id) %>

							<%= link_to t('.progress_udpate'),
									progress_update_path(:idea_id => @idea.id, :organization_id => current_user.organization_users.first.organization_id),
									:class => 'btn btn-mini btn-primary fancybox' %>
						<% else %>
							&nbsp;
						<% end %>
					</div>
					<div class="span3" style="text-align: right;">
						<% if progresses.first.is_completed && !progresses.first.url.empty? %>
							<strong><%= "#{t('.finished')}!" %></strong>
							<%= link_to t('.news_url'), progresses.first.url, :target => :blank, :class => 'btn btn-mini' %>
						<% end %>
					</div>
				</div>
				<% progresses.each do |progress| %>
					<div>
						<strong><%= l progress.progress_date, :format => :long if progress.progress_date %></strong>
						<% if current_user.organization_users && !current_user.organization_users.empty? &&
									org.id == current_user.organization_users.first.organization_id &&
									@idea.organization_claimed_idea?(current_user.organization_users.first.organization_id) %>

							<%= link_to t('.edit_progress'),
									edit_progress_path(progress.id),
									:class => 'btn btn-mini btn-primary fancybox' %>
						<% end %>

						<%= simple_format progress.explaination %>
					</div>
				<% end %>
			</div>
		<% end %>
	<% end %>
</div>

<h3><%= t('app.common.comments') %></h3>
<div class="fb-comments" data-href="<%= current_url%>" data-num-posts="2" data-width="470"></div>
